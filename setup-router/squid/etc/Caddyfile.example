# Caddy 反向代理配置示例
# 用于将 HTTPS 请求转发到 Squid 缓存代理
#
# 架构: 客户端 (HTTPS:443) -> Caddy -> Squid (HTTP:3128) -> 源站 (HTTPS:443)

# =============================================================================
# 全局配置
# =============================================================================
{
    # 自动 HTTPS 证书管理
    email your-email@example.com
    
    # 如果使用自签名证书测试，取消下面的注释
    # local_certs
}

# =============================================================================
# 代码片段 - 统一的反向代理配置
# =============================================================================
(squid_proxy) {
    reverse_proxy squid:3128 {
        header_up Host {host}
        # 删除所有代理标识头，防止源站检测
        header_up -Via
        header_up -X-Forwarded-For
        header_up -X-Forwarded-Proto
        header_up -X-Forwarded-Host
        header_up -X-Real-IP
        header_up -Forwarded
    }
}

# =============================================================================
# GitHub 资产
# =============================================================================
release-assets.githubusercontent.com,
objects.githubusercontent.com,
codeload.github.com,
gist.githubusercontent.com,
user-attachments.githubusercontent.com {
    import squid_proxy
}

# =============================================================================
# Unreal Engine
# =============================================================================
cdn.unrealengine.com {
    import squid_proxy
}

# =============================================================================
# 主流 CDN
# =============================================================================
cdnjs.cloudflare.com,
cdn.jsdelivr.net,
unpkg.com, www.unpkg.com,
cdn.staticfile.org,
cdn.bootcdn.net,
fonts.googleapis.com,
fonts.gstatic.com,
ajax.googleapis.com,
stackpath.bootstrapcdn.com {
    import squid_proxy
}

# =============================================================================
# 微软下载
# =============================================================================
download.microsoft.com,
download.windowsupdate.com,
dl.delivery.mp.microsoft.com,
download.visualstudio.microsoft.com,
download.visualstudio.com,
vscode.download.prss.microsoft.com,
globalcdn.nuget.org,
update.code.visualstudio.com,
api.nuget.org {
    import squid_proxy
}

# =============================================================================
# Unity
# =============================================================================
download.unity3d.com,
public-cdn.cloud.unity3d.com,
packages.unity.com {
    import squid_proxy
}

# =============================================================================
# Golang 模块代理
# =============================================================================
proxy.golang.org,
sum.golang.org {
    import squid_proxy
}

# =============================================================================
# Java Maven 仓库
# =============================================================================
repo1.maven.org,
repo.maven.apache.org,
plugins.gradle.org {
    import squid_proxy
}

# =============================================================================
# Python PyPI
# =============================================================================
pypi.org,
pypi.python.org,
files.pythonhosted.org {
    import squid_proxy
}

# =============================================================================
# Node.js npm
# =============================================================================
registry.npmjs.org,
registry.yarnpkg.com,
registry.npmmirror.com,
cdn.npmmirror.com,
mirrors.cloud.tencent.com {
    import squid_proxy
}
