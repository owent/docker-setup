# Apache Traffic Server Configuration (Legacy Format for ATS 9.x)
# Generated from records.yaml

# ==============================================================================
# 基础配置
# ==============================================================================
# 代理模式
CONFIG proxy.config.reverse_proxy.enabled INT 1
CONFIG proxy.config.url_remap.remap_required INT 1

# 监听端口 (HTTP only, Caddy 处理 HTTPS)
CONFIG proxy.config.http.server_ports STRING 3126

# 运行用户
CONFIG proxy.config.admin.user_id STRING trafficserver

# ==============================================================================
# 高并发配置
# ==============================================================================
CONFIG proxy.config.exec_thread.autoconfig INT 1
CONFIG proxy.config.exec_thread.autoconfig.scale FLOAT 1.5
CONFIG proxy.config.exec_thread.limit INT 16
CONFIG proxy.config.accept_threads INT 2
CONFIG proxy.config.task_threads INT 8

# ==============================================================================
# 连接配置
# ==============================================================================
CONFIG proxy.config.net.connections_throttle INT 2000000
CONFIG proxy.config.http.keep_alive_enabled_in INT 1
CONFIG proxy.config.http.keep_alive_enabled_out INT 1
CONFIG proxy.config.http.keep_alive_no_activity_timeout_in INT 60
CONFIG proxy.config.http.keep_alive_no_activity_timeout_out INT 60
CONFIG proxy.config.http.connect_attempts_timeout INT 30
CONFIG proxy.config.http.transaction_no_activity_timeout_in INT 120
CONFIG proxy.config.http.transaction_no_activity_timeout_out INT 120

# ==============================================================================
# 缓存配置
# ==============================================================================
CONFIG proxy.config.http.cache.http INT 1
CONFIG proxy.config.http.cache.max_object_size INT 5368709120
CONFIG proxy.config.cache.ram_cache.size INT 2147483648
CONFIG proxy.config.cache.enable_read_while_writer INT 1
CONFIG proxy.config.http.cache.heuristic_min_lifetime INT 3600
CONFIG proxy.config.http.cache.heuristic_max_lifetime INT 86400
CONFIG proxy.config.http.cache.heuristic_lm_factor FLOAT 0.1
CONFIG proxy.config.http.cache.ignore_server_no_cache INT 1
CONFIG proxy.config.http.cache.ignore_client_no_cache INT 1
CONFIG proxy.config.http.cache.ignore_client_cc_max_age INT 1
CONFIG proxy.config.http.cache.cache_responses_to_cookies INT 1

# ==============================================================================
# 隐私配置 - 隐藏代理标识
# ==============================================================================
CONFIG proxy.config.http.insert_request_via_str INT 0
CONFIG proxy.config.http.insert_response_via_str INT 0
# 注意: insert_forwarded 不使用 INT 0，直接删除或注释掉以禁用
# CONFIG proxy.config.http.insert_forwarded STRING none
CONFIG proxy.config.http.anonymize_insert_client_ip INT 0
CONFIG proxy.config.http.anonymize_remove_from INT 1
CONFIG proxy.config.http.anonymize_remove_referer INT 0
CONFIG proxy.config.http.anonymize_remove_user_agent INT 0
CONFIG proxy.config.http.anonymize_remove_cookie INT 0
CONFIG proxy.config.http.anonymize_remove_client_ip INT 1

# ==============================================================================
# 日志配置
# ==============================================================================
CONFIG proxy.config.log.logging_enabled INT 3
CONFIG proxy.config.log.max_space_mb_for_logs INT 2048
CONFIG proxy.config.log.rolling_enabled INT 1
CONFIG proxy.config.log.rolling_interval_sec INT 86400
CONFIG proxy.config.log.rolling_size_mb INT 200
CONFIG proxy.config.log.auto_delete_rolled_files INT 1

# ==============================================================================
# Body Factory (错误页面模板)
# ==============================================================================
CONFIG proxy.config.body_factory.template_sets_dir STRING /usr/share/trafficserver/body_factory

# ==============================================================================
# DNS 配置
# ==============================================================================
CONFIG proxy.config.dns.nameservers STRING 223.5.5.5 119.29.29.29
CONFIG proxy.config.dns.resolv_conf STRING NULL

# ==============================================================================
# 错误处理
# ==============================================================================
CONFIG proxy.config.http.connect_attempts_max_retries INT 3
CONFIG proxy.config.http.connect_attempts_rr_retries INT 2
CONFIG proxy.config.http.parent_proxy.retry_time INT 30
CONFIG proxy.config.http.parent_proxy.fail_threshold INT 3
