# Unity Package Manager 缓存策略
#
# packages.unity.com API 返回包元数据
# 这些数据变化不频繁，可以设置适度缓存减少 304 验证请求
#
# 缓存策略:
#   - 包元数据: 6小时 (平衡更新及时性和缓存效率)

# ==============================================================================
# 阶段1: REMAP 阶段 - 启用缓存配置
# ==============================================================================
# 所有请求启用缓存
cond %{CLIENT-URL:PATH} /.*/
  set-config proxy.config.http.cache.http 1
  set-config proxy.config.http.cache.cache_responses_to_cookies 1

# ==============================================================================
# 阶段2: READ_RESPONSE_HDR_HOOK - 修改响应头添加 Cache-Control
# ==============================================================================
# 包元数据 - 6小时缓存
cond %{READ_RESPONSE_HDR_HOOK}
cond %{CLIENT-URL:PATH} /^\/com\./
  set-header Cache-Control "public, max-age=21600"

# 其他 API 请求 - 3小时缓存
cond %{READ_RESPONSE_HDR_HOOK}
cond %{CLIENT-URL:PATH} /^\/com\./ [NOT]
  set-header Cache-Control "public, max-age=10800"
