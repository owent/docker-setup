# GitHub release-assets 缓存策略
# 目标: 对不可变的发布资产设置长缓存
#
# ATS header_rewrite 语法:
#   条件: cond %{CLIENT-URL:PATH} /regex/
#   操作: set-header <name> <value>
#
# 阶段说明:
#   - REMAP_PSEUDO_HOOK: 允许缓存
#   - READ_RESPONSE_HDR_HOOK: 覆盖响应缓存头

# ============================================================================== 
# 阶段1: REMAP 阶段 - 启用缓存配置
# ============================================================================== 
cond %{CLIENT-URL:PATH} /\/github-production-release-asset\//
  set-config proxy.config.http.cache.http 1
  set-config proxy.config.http.cache.cache_responses_to_cookies 1

# ============================================================================== 
# 阶段2: READ_RESPONSE_HDR_HOOK - 添加/覆盖 Cache-Control
# ============================================================================== 
cond %{READ_RESPONSE_HDR_HOOK}
cond %{CLIENT-URL:PATH} /\/github-production-release-asset\//
  set-header Cache-Control "public, max-age=1209600, immutable"
